<!-- app/templates/settings.html -->
{% extends "base.html" %}

{% block content %}
<h2>Einstellungen</h2>

<form method="post" action="{{ url_for('settings_page') }}">
  <h3>Token eingeben</h3>
  <div class="form-group">
    <label for="token">Git Token:</label>
    <input type="text" id="token" name="token" class="form-control" value="{{ token }}">
  </div>
  
  <h3>Projekt pflegen</h3>
  <table class="table table-bordered" id="projectsTable">
    <thead>
      <tr>
        <th>Projektname</th>
        <th>Link</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody>
      {% for name, link in projects.items() %}
      <tr>
        <td><input type="text" name="project_name[]" class="form-control" value="{{ name }}"></td>
        <td><input type="text" name="project_url[]" class="form-control" value="{{ link }}"></td>
        <td><button type="button" class="btn btn-danger btn-sm" onclick="deleteRow(this)">Löschen</button></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <button type="button" class="btn btn-secondary" onclick="addRow()">Projekt hinzufügen</button>
  
  <br><br>
  <button type="submit" class="btn btn-primary">Einstellungen speichern</button>
</form>

<script>
function addRow() {
  var table = document.getElementById("projectsTable").getElementsByTagName('tbody')[0];
  var row = table.insertRow();
  var cell1 = row.insertCell(0);
  var cell2 = row.insertCell(1);
  var cell3 = row.insertCell(2);
  
  cell1.innerHTML = '<input type="text" name="project_name[]" class="form-control">';
  cell2.innerHTML = '<input type="text" name="project_url[]" class="form-control">';
  cell3.innerHTML = '<button type="button" class="btn btn-danger btn-sm" onclick="deleteRow(this)">Löschen</button>';
}

function deleteRow(button) {
  var row = button.parentNode.parentNode;
  row.parentNode.removeChild(row);
}
</script>

{% endblock %}
